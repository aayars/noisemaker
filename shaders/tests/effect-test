#!/bin/zsh

set -e

# Change to the project root directory (parent of shaders)
cd "$(dirname "$0")/../.."

# Default backend from environment, or use wgsl
BACKEND="${BACKEND:-wgsl}"

# Select the appropriate project based on backend
if [[ "$BACKEND" == "wgsl" ]]; then
	PROJECT="shaders-chromium-webgpu"
else
	PROJECT="shaders-chromium"
fi

if [[ $# -gt 0 ]]; then
	if [[ $1 == "all" || $1 == "ALL" ]]; then
		unset EFFECT_ONLY
	else
		EFFECT_ONLY="${(j:,:)argv}"
	fi
else
	EFFECT_ONLY="nd/physarum"
fi

if [[ -n ${EFFECT_ONLY-} ]]; then
	BACKEND="$BACKEND" EFFECT_ONLY="$EFFECT_ONLY" npx playwright test --project="$PROJECT" --headed --reporter=line shaders/tests/playwright/effects.spec.js
else
	BACKEND="$BACKEND" npx playwright test --project="$PROJECT" --headed --reporter=line shaders/tests/playwright/effects.spec.js
fi
