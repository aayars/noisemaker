import { Effect } from '../../../src/runtime/effect.js';

export default class DepthOfField extends Effect {
  name = "DepthOfField";
  namespace = "classicNoisedeck";
  func = "depthOfField";


  // WGSL uniform packing layout - maps uniform names to vec4 slots/components
  uniformLayout = {
        resolution: { slot: 0, components: 'xy' },
    time: { slot: 0, components: 'z' },
    seed: { slot: 0, components: 'w' },
    focalDistance: { slot: 1, components: 'x' },
    aperture: { slot: 1, components: 'y' },
    sampleBias: { slot: 1, components: 'z' },
    depthSource: { slot: 1, components: 'w' }
  };
  globals = {
    tex: {
      type: "surface",
      default: "inputTex",
      ui: {
        label: "depth map"
      }
    },
    seed: {
      type: "int",
      default: 1,
      uniform: "seed",
      min: 1,
      max: 100,
      ui: {
        label: "seed",
        control: "slider"
      }
    },
    focalDistance: {
      type: "float",
      default: 50,
      uniform: "focalDistance",
      min: 1,
      max: 100,
      ui: {
        label: "focal dist",
        control: "slider"
      }
    },
    aperture: {
      type: "float",
      default: 4,
      uniform: "aperture",
      min: 1,
      max: 10,
      ui: {
        label: "aperture",
        control: "slider"
      }
    },
    sampleBias: {
      type: "float",
      default: 10,
      uniform: "sampleBias",
      min: 2,
      max: 20,
      ui: {
        label: "sample bias",
        control: "slider"
      }
    },
    depthSource: {
      type: "int",
      default: 1,
      uniform: "depthSource",
      choices: {
        "inputTex": 0,
        "tex": 1
      },
      ui: {
        label: "depth source",
        control: "dropdown"
      }
    }
  };

  passes = [
    {
      name: "render",
      program: "depthOfField",
      inputs: {
              tex0: "inputTex",
              tex1: "tex"
            }
,
      outputs: {
        fragColor: "outputTex"
      }
    }
  ];
}
